settings:
  volume_name: myvolume
  working_directory: /src
  shell: [ "sh", "-x", "-e" ]
  network_name: mynetwork

repos:
  - name: main
    location: https://github.com/docker/app
    shallow: true
    directory: .

services:
  - name: web
    image: nginx
  - name: mysql
    image: mysql
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes

steps:

  - name: test
    image: alpine
    environment:
      - TEST=foobar
    commands:
      - pwd
      - ls -l
      - ip a
      - printenv
      - df
      - test -f .git/shallow

  - name: web
    image: alpine
    commands:
      - apk update
      - apk add curl
      - curl -s web

  - name: user
    image: alpine
    user: 1000
    commands:
      - id -u

  - name: entrypoint
    image: alpine/git
    override_entrypoint: true
    commands:
      - pwd
